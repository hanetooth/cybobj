{"version":3,"file":"index.umd.js","sources":["../src/Mutator.ts"],"sourcesContent":["import type { descriptorT, keyT, MutatorT, primalObjT } from './Types';\n\nexport default class Mutator implements MutatorT {\n  /**\n   * @type boolean\n   */\n  protected isExtensible = true;\n  [key: keyT]: unknown;\n\n  /**\n   * Construct given object to be listenable\n   * @param {primalObjT} primalObj\n   * @param {boolean} isExtensible\n   */\n  constructor(primalObj: primalObjT, isExtensible = false) {\n    Object.keys(primalObj).forEach((key) => {\n      const descriptor = primalObj[key] as descriptorT;\n      this.add(key, descriptor);\n    });\n    this.isExtensible = isExtensible;\n  }\n\n  /**\n   * Add new listenable property to $self\n   * @param {keyT} key\n   * @param {descriptorT} descriptorT\n   */\n  add(key: keyT, descriptorT: descriptorT) {\n    if (!this.isExtensible) {\n      throw 'Adding new property to a unexpendable Mutator.';\n    }\n    this.makePropertyWatchable(key, descriptorT);\n  }\n\n  /**\n   * Couple given listeners with acessor/mutator and assign to the given property ($key)\n   * @param {keyT} key\n   * @param {descriptorT} descriptor\n   */\n  protected makePropertyWatchable(key: keyT, descriptor: descriptorT): void {\n    const privateKey: keyT = `#${key}`;\n    Object.defineProperty(this, key, {\n      enumerable: true,\n      configurable: false,\n      get() {\n        const value = this[privateKey];\n        descriptor.onAccess?.(key, value);\n        return value;\n      },\n      set(newVal) {\n        this[privateKey] = newVal;\n        descriptor.onChange?.(key, this[privateKey], newVal);\n      },\n    });\n    this[key] = descriptor.value;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAEA,MAAA,OAAA,kBAAA,YAAA;EAOE;;;;EAIG;MACH,SAAY,OAAA,CAAA,SAAqB,EAAE,YAAoB,EAAA;EAApB,QAAA,IAAA,YAAA,KAAA,KAAA,CAAA,EAAA,EAAA,YAAoB,GAAA,KAAA,CAAA,EAAA;UAAvD,IAMC,KAAA,GAAA,IAAA,CAAA;EAjBD;;EAEG;UACO,IAAY,CAAA,YAAA,GAAG,IAAI,CAAC;UAS5B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,UAAC,GAAG,EAAA;EACjC,YAAA,IAAM,UAAU,GAAG,SAAS,CAAC,GAAG,CAAgB,CAAC;EACjD,YAAA,KAAI,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;EAC5B,SAAC,CAAC,CAAC;EACH,QAAA,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;OAClC;EAED;;;;EAIG;EACH,IAAA,OAAA,CAAA,SAAA,CAAA,GAAG,GAAH,UAAI,GAAS,EAAE,WAAwB,EAAA;EACrC,QAAA,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;EACtB,YAAA,MAAM,gDAAgD,CAAC;EACxD,SAAA;EACD,QAAA,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;OAC9C,CAAA;EAED;;;;EAIG;EACO,IAAA,OAAA,CAAA,SAAA,CAAA,qBAAqB,GAA/B,UAAgC,GAAS,EAAE,UAAuB,EAAA;EAChE,QAAA,IAAM,UAAU,GAAS,GAAI,CAAA,MAAA,CAAA,GAAG,CAAE,CAAC;EACnC,QAAA,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE;EAC/B,YAAA,UAAU,EAAE,IAAI;EAChB,YAAA,YAAY,EAAE,KAAK;cACnB,GAAG,EAAA,YAAA;;EACD,gBAAA,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;kBAC/B,CAAA,EAAA,GAAA,UAAU,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,UAAA,EAAG,GAAG,EAAE,KAAK,CAAC,CAAC;EAClC,gBAAA,OAAO,KAAK,CAAC;eACd;EACD,YAAA,GAAG,YAAC,MAAM,EAAA;;EACR,gBAAA,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;EAC1B,gBAAA,CAAA,EAAA,GAAA,UAAU,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,UAAA,EAAG,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,EAAE,MAAM,CAAC,CAAC;eACtD;EACF,SAAA,CAAC,CAAC;EACH,QAAA,IAAI,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC;OAC9B,CAAA;MACH,OAAC,OAAA,CAAA;EAAD,CAAC,EAAA;;;;;;;;;;"}