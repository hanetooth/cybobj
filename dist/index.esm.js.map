{"version":3,"file":"index.esm.js","sources":["../src/Mutator.ts"],"sourcesContent":["import type { descriptorT, keyT, MutatorT, primalObjT } from './Types';\n\nexport default class Mutator implements MutatorT {\n  /**\n   * @type boolean\n   */\n  protected isExtensible = true;\n  [key: keyT]: unknown;\n\n  /**\n   * Construct given object to be listenable\n   * @param {primalObjT} primalObj\n   * @param {boolean} isExtensible\n   */\n  constructor(primalObj: primalObjT, isExtensible = false) {\n    Object.keys(primalObj).forEach((key) => {\n      const descriptor = primalObj[key] as descriptorT;\n      this.add(key, descriptor);\n    });\n    this.isExtensible = isExtensible;\n  }\n\n  /**\n   * Add new listenable property to $self\n   * @param {keyT} key\n   * @param {descriptorT} descriptorT\n   */\n  add(key: keyT, descriptorT: descriptorT) {\n    if (!this.isExtensible) {\n      throw 'Adding new property to a unexpendable Mutator.';\n    }\n    this.makePropertyWatchable(key, descriptorT);\n  }\n\n  /**\n   * Couple given listeners with acessor/mutator and assign to the given property ($key)\n   * @param {keyT} key\n   * @param {descriptorT} descriptor\n   */\n  protected makePropertyWatchable(key: keyT, descriptor: descriptorT): void {\n    const privateKey: keyT = `#${key}`;\n    Object.defineProperty(this, key, {\n      enumerable: true,\n      configurable: false,\n      get() {\n        const value = this[privateKey];\n        descriptor.onAccess?.(key, value);\n        return value;\n      },\n      set(newVal) {\n        this[privateKey] = newVal;\n        descriptor.onChange?.(key, this[privateKey], newVal);\n      },\n    });\n    this[key] = descriptor.value;\n  }\n}\n"],"names":[],"mappings":";;;;;;AAEA,IAAA,OAAA,kBAAA,YAAA;AAOE;;;;AAIG;IACH,SAAY,OAAA,CAAA,SAAqB,EAAE,YAAoB,EAAA;AAApB,QAAA,IAAA,YAAA,KAAA,KAAA,CAAA,EAAA,EAAA,YAAoB,GAAA,KAAA,CAAA,EAAA;QAAvD,IAMC,KAAA,GAAA,IAAA,CAAA;AAjBD;;AAEG;QACO,IAAY,CAAA,YAAA,GAAG,IAAI,CAAC;QAS5B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,UAAC,GAAG,EAAA;AACjC,YAAA,IAAM,UAAU,GAAG,SAAS,CAAC,GAAG,CAAgB,CAAC;AACjD,YAAA,KAAI,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;AAC5B,SAAC,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;KAClC;AAED;;;;AAIG;AACH,IAAA,OAAA,CAAA,SAAA,CAAA,GAAG,GAAH,UAAI,GAAS,EAAE,WAAwB,EAAA;AACrC,QAAA,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;AACtB,YAAA,MAAM,gDAAgD,CAAC;AACxD,SAAA;AACD,QAAA,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;KAC9C,CAAA;AAED;;;;AAIG;AACO,IAAA,OAAA,CAAA,SAAA,CAAA,qBAAqB,GAA/B,UAAgC,GAAS,EAAE,UAAuB,EAAA;AAChE,QAAA,IAAM,UAAU,GAAS,GAAI,CAAA,MAAA,CAAA,GAAG,CAAE,CAAC;AACnC,QAAA,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,GAAG,EAAE;AAC/B,YAAA,UAAU,EAAE,IAAI;AAChB,YAAA,YAAY,EAAE,KAAK;YACnB,GAAG,EAAA,YAAA;;AACD,gBAAA,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC/B,CAAA,EAAA,GAAA,UAAU,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,UAAA,EAAG,GAAG,EAAE,KAAK,CAAC,CAAC;AAClC,gBAAA,OAAO,KAAK,CAAC;aACd;AACD,YAAA,GAAG,YAAC,MAAM,EAAA;;AACR,gBAAA,IAAI,CAAC,UAAU,CAAC,GAAG,MAAM,CAAC;AAC1B,gBAAA,CAAA,EAAA,GAAA,UAAU,CAAC,QAAQ,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,UAAA,EAAG,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,EAAE,MAAM,CAAC,CAAC;aACtD;AACF,SAAA,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC;KAC9B,CAAA;IACH,OAAC,OAAA,CAAA;AAAD,CAAC,EAAA;;;;"}